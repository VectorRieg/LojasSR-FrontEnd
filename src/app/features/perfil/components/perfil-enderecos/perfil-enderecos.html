<div class="perfil-enderecos-container">
  <div class="header">
    <h2>Meus Endereços</h2>
    <button type="button" class="btn-primary" (click)="novoEndereco()" [disabled]="carregando">
      + Novo Endereço
    </button>
  </div>

  <!-- Mensagem de Feedback -->
  @if (mensagem) {
    <div class="mensagem" [class.sucesso]="mensagemTipo === 'sucesso'" [class.erro]="mensagemTipo === 'erro'">
      {{ mensagem }}
    </div>
  }

  <!-- Loading -->
  @if (carregando && !mostrarFormulario) {
    <div class="loading">Carregando...</div>
  }

  <!-- Formulário de Endereço -->
  @if (mostrarFormulario) {
    <div class="formulario-container">
      <h3>{{ enderecoEmEdicao ? 'Editar Endereço' : 'Novo Endereço' }}</h3>

      <form [formGroup]="enderecoForm" (ngSubmit)="salvarEndereco()">
        <div class="form-row">
          <div class="form-group cep-group">
            <label for="cep">CEP *</label>
            <input
              type="text"
              id="cep"
              formControlName="cep"
              placeholder="00000-000"
              (blur)="buscarCep()"
              [class.invalido]="campoInvalido('cep')"
            >
            @if (campoInvalido('cep')) {
              <span class="erro-mensagem">CEP é obrigatório</span>
            }
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="rua">Rua *</label>
            <input
              type="text"
              id="rua"
              formControlName="rua"
              [class.invalido]="campoInvalido('rua')"
            >
            @if (campoInvalido('rua')) {
              <span class="erro-mensagem">Rua é obrigatória</span>
            }
          </div>

          <div class="form-group numero-group">
            <label for="numero">Número *</label>
            <input
              type="text"
              id="numero"
              formControlName="numero"
              [class.invalido]="campoInvalido('numero')"
            >
            @if (campoInvalido('numero')) {
              <span class="erro-mensagem">Número é obrigatório</span>
            }
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="complemento">Complemento</label>
            <input type="text" id="complemento" formControlName="complemento">
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="bairro">Bairro *</label>
            <input
              type="text"
              id="bairro"
              formControlName="bairro"
              [class.invalido]="campoInvalido('bairro')"
            >
            @if (campoInvalido('bairro')) {
              <span class="erro-mensagem">Bairro é obrigatório</span>
            }
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="cidade">Cidade *</label>
            <input
              type="text"
              id="cidade"
              formControlName="cidade"
              [class.invalido]="campoInvalido('cidade')"
            >
            @if (campoInvalido('cidade')) {
              <span class="erro-mensagem">Cidade é obrigatória</span>
            }
          </div>

          <div class="form-group estado-group">
            <label for="estado">Estado *</label>
            <input
              type="text"
              id="estado"
              formControlName="estado"
              maxlength="2"
              placeholder="UF"
              [class.invalido]="campoInvalido('estado')"
            >
            @if (campoInvalido('estado')) {
              <span class="erro-mensagem">Estado é obrigatório (UF)</span>
            }
          </div>
        </div>

        <div class="form-row">
          <div class="form-group-checkbox">
            <input type="checkbox" id="principal" formControlName="principal">
            <label for="principal">Definir como endereço principal</label>
          </div>
        </div>

        <div class="form-actions">
          <button type="button" class="btn-secondary" (click)="cancelarFormulario()" [disabled]="carregando">
            Cancelar
          </button>
          <button type="submit" class="btn-primary" [disabled]="carregando || enderecoForm.invalid">
            {{ enderecoEmEdicao ? 'Atualizar' : 'Salvar' }}
          </button>
        </div>
      </form>
    </div>
  }

  <!-- Lista de Endereços -->
  <div class="enderecos-lista">
    @if (enderecos.length === 0 && !carregando) {
      <div class="vazio">
        <p>Você ainda não possui endereços cadastrados.</p>
        <p>Clique em "Novo Endereço" para adicionar um.</p>
      </div>
    }

    @for (endereco of enderecos; track endereco.id) {
      <div class="endereco-card" [class.principal]="endereco.principal">
        @if (endereco.principal) {
          <span class="badge-principal">Principal</span>
        }

        <div class="endereco-info">
          <p class="endereco-rua">
            {{ endereco.rua }}, {{ endereco.numero }}
            @if (endereco.complemento) {
              <span> - {{ endereco.complemento }}</span>
            }
          </p>
          <p class="endereco-bairro">{{ endereco.bairro }}</p>
          <p class="endereco-cidade">{{ endereco.cidade }} - {{ endereco.estado }}</p>
          <p class="endereco-cep">CEP: {{ endereco.cep }}</p>
        </div>

        <div class="endereco-acoes">
          @if (!endereco.principal) {
            <button
              type="button"
              class="btn-link"
              (click)="definirPrincipal(endereco)"
              [disabled]="carregando"
            >
              Definir como principal
            </button>
          }
          <button
            type="button"
            class="btn-link"
            (click)="editarEndereco(endereco)"
            [disabled]="carregando"
          >
            Editar
          </button>
          <button
            type="button"
            class="btn-link btn-danger"
            (click)="removerEndereco(endereco)"
            [disabled]="carregando"
          >
            Remover
          </button>
        </div>
      </div>
    }
  </div>
</div>
