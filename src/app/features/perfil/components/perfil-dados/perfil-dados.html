<div class="perfil-dados-container">
  <h2>Meus Dados</h2>

  <!-- Mensagem de Feedback -->
  @if (mensagem) {
    <div class="mensagem" [class.sucesso]="mensagemTipo === 'sucesso'" [class.erro]="mensagemTipo === 'erro'">
      {{ mensagem }}
    </div>
  }

  <!-- Loading -->
  @if (carregando) {
    <div class="loading">Carregando...</div>
  }

  <!-- Formulário de Dados -->
  <form [formGroup]="dadosForm" (ngSubmit)="salvarDados()" class="form-dados">
    <h3>Dados Pessoais</h3>

    <div class="form-row">
      <div class="form-group">
        <label for="nome">Nome Completo *</label>
        <input
          type="text"
          id="nome"
          formControlName="nome"
          [class.invalido]="campoInvalido(dadosForm, 'nome')"
        >
        @if (campoInvalido(dadosForm, 'nome')) {
          <span class="erro-mensagem">Nome é obrigatório (mínimo 3 caracteres)</span>
        }
      </div>
    </div>

    <div class="form-row">
      <div class="form-group">
        <label for="email">E-mail *</label>
        <input
          type="email"
          id="email"
          formControlName="email"
          [class.invalido]="campoInvalido(dadosForm, 'email')"
        >
        @if (campoInvalido(dadosForm, 'email')) {
          <span class="erro-mensagem">E-mail inválido</span>
        }
      </div>
    </div>

    <div class="form-row">
      <div class="form-group">
        <label for="cpf">CPF</label>
        <input
          type="text"
          id="cpf"
          formControlName="cpf"
          placeholder="000.000.000-00"
        >
      </div>

      <div class="form-group">
        <label for="telefone">Telefone</label>
        <input
          type="tel"
          id="telefone"
          formControlName="telefone"
          placeholder="(00) 00000-0000"
        >
      </div>
    </div>

    <h3>Endereço</h3>

    <div class="form-row">
      <div class="form-group cep-group">
        <label for="cep">CEP</label>
        <input
          type="text"
          id="cep"
          formControlName="cep"
          placeholder="00000-000"
          (blur)="buscarCep()"
        >
      </div>
    </div>

    <div class="form-row">
      <div class="form-group">
        <label for="rua">Rua</label>
        <input type="text" id="rua" formControlName="rua">
      </div>

      <div class="form-group numero-group">
        <label for="numero">Número</label>
        <input type="text" id="numero" formControlName="numero">
      </div>
    </div>

    <div class="form-row">
      <div class="form-group">
        <label for="complemento">Complemento</label>
        <input type="text" id="complemento" formControlName="complemento">
      </div>
    </div>

    <div class="form-row">
      <div class="form-group">
        <label for="bairro">Bairro</label>
        <input type="text" id="bairro" formControlName="bairro">
      </div>
    </div>

    <div class="form-row">
      <div class="form-group">
        <label for="cidade">Cidade</label>
        <input type="text" id="cidade" formControlName="cidade">
      </div>

      <div class="form-group estado-group">
        <label for="estado">Estado</label>
        <input type="text" id="estado" formControlName="estado" maxlength="2">
      </div>
    </div>

    <div class="form-actions">
      <button type="submit" class="btn-primary" [disabled]="carregando || dadosForm.invalid">
        Salvar Dados
      </button>
    </div>
  </form>

  <!-- Seção de Alteração de Senha -->
  <div class="senha-section">
    <button type="button" class="btn-secondary" (click)="toggleFormularioSenha()">
      {{ mostrarFormularioSenha ? 'Cancelar Alteração de Senha' : 'Alterar Senha' }}
    </button>

    @if (mostrarFormularioSenha) {
      <form [formGroup]="senhaForm" (ngSubmit)="alterarSenha()" class="form-senha">
        <h3>Alterar Senha</h3>

        <div class="form-group">
          <label for="senhaAtual">Senha Atual *</label>
          <input
            type="password"
            id="senhaAtual"
            formControlName="senhaAtual"
            [class.invalido]="campoInvalido(senhaForm, 'senhaAtual')"
          >
          @if (campoInvalido(senhaForm, 'senhaAtual')) {
            <span class="erro-mensagem">Senha atual é obrigatória (mínimo 6 caracteres)</span>
          }
        </div>

        <div class="form-group">
          <label for="novaSenha">Nova Senha *</label>
          <input
            type="password"
            id="novaSenha"
            formControlName="novaSenha"
            [class.invalido]="campoInvalido(senhaForm, 'novaSenha')"
          >
          @if (campoInvalido(senhaForm, 'novaSenha')) {
            <span class="erro-mensagem">Nova senha é obrigatória (mínimo 6 caracteres)</span>
          }
        </div>

        <div class="form-group">
          <label for="confirmarSenha">Confirmar Nova Senha *</label>
          <input
            type="password"
            id="confirmarSenha"
            formControlName="confirmarSenha"
            [class.invalido]="campoInvalido(senhaForm, 'confirmarSenha')"
          >
          @if (campoInvalido(senhaForm, 'confirmarSenha')) {
            <span class="erro-mensagem">Confirme a nova senha</span>
          }
          @if (senhaForm.errors?.['senhasNaoConferem'] && senhaForm.get('confirmarSenha')?.touched) {
            <span class="erro-mensagem">As senhas não conferem</span>
          }
        </div>

        <div class="form-actions">
          <button type="submit" class="btn-primary" [disabled]="carregando || senhaForm.invalid">
            Alterar Senha
          </button>
        </div>
      </form>
    }
  </div>
</div>
